{"version":3,"sources":["woleet-widget.js"],"names":["root","Widget","hash","Error","state","defineProperty","target","name","value","Object","enumerable","$","element","Element","TypeError","self","this","rts","def","attr","val","setAttribute","removeAttribute","e","Array","isArray","forEach","classList","remove","add","text","innerText","innerHTML","url","removeClass","addClass","props","map","p","style","prop","type","listener","capture","addEventListener","elt","appendChild","toDom","err","console","warn","$touch","arguments","length","undefined","c","d","document","createElement","widget","head","logo","x","receipt","on","forceReceipt","reset","cancel","cancelHash","body","hashZone","hashProgessContainer","percentage","progressBar","infoZone","items","_this","item","mainTextZone","subTextZone","byTextZone","signTextZone","identityTextZone","warnTextZone","expanded","selected","expandList","selectItem","push","html","dropZone","inputContainer","input","setInputFile","foot","init","resetText","hide","show","clear","flush","expand","call","files","hasher","woleet","file","Hasher","setVue","setProgress","progress","toFixed","width","Promise","resolve","reject","reader","FileReader","onloadend","JSON","parse","result","readAsText","then","verify","DAB","res","code","catch","woleetDAB","WoleetDAB","results","i","addVue","addResults","sort","b","a","timestamp","hasOwnProperty","message","start","error","r","vue","index","addItem","sig","signature","pubKey","confirmations","date","toLocaleDateString","year","month","day","hour","minute","formatDate","idStatus","identityVerificationStatus","identity","assign","signedIdentity","identityURL","link","encodeURIComponent","commonName","organization","organizationalUnit","locality","country","detail","main","sub","trace","getDetailedMessage","ctx","setReceipt","widgets","getElementsByClassName","getAttribute","window"],"mappings":"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","sourcesContent":["(function (root) {\n\n  /**\n   * @param [hash]\n   * @constructor\n   */\n  function Widget(hash) {\n\n    // Check parameter\n    if (hash && typeof hash !== 'string')\n      throw new Error('Invalid parameter type');\n\n    // Init state\n    const state = {\n      state: 'initial',\n      hash: null\n    };\n\n    /**\n     * @typedef {{\n     *      target:function(),\n     *      addClass: function(string[]|string):$,\n     *      removeClass: function(string[]|string):$,\n     *      show: function():$,\n     *      hide: function():$,\n     *      text: function(text: string, add?: boolean):$,\n     *      html: function(text: string, add?: boolean):$,\n     *      link: function(link: string):$,\n     *      clear: function():$,\n     *      style: function(props: object),\n     *      attr: function(attr: string, val: *),\n     *      on: function(type: string, listener:function, capture: boolean),\n     *      toDom: function()\n     *      }} $\n     */\n\n    const defineProperty = (target) => (name, value) => Object.defineProperty(target, name, {\n      enumerable: false,\n      value\n    });\n\n    /**\n     * @description \"virtual\" DOM element Object\n     * @param {Element|string} element\n     * @private\n     */\n    const $ = function (element) {\n\n      if ((!element instanceof Element)) {\n        throw new TypeError;\n      }\n\n      const target = element;\n      /**\n       * @type {$}\n       */\n      const self = this;\n      const rts = () => self;\n      const def = defineProperty(this);\n\n      def('target', () => target);\n      def('attr', (attr, val) => rts(val ? target.setAttribute(attr, val) : target.removeAttribute(attr)));\n      def('removeClass', (e) => rts(Array.isArray(e) ? e.forEach(e => target.classList.remove(e)) : target.classList.remove(e)));\n      def('addClass', (e) => rts(Array.isArray(e) ? e.forEach(e => target.classList.add(e)) : target.classList.add(e)));\n      def('text', (text, add) => rts(add ? target.innerText += text : target.innerText = text));\n      def('html', (text, add) => rts(add ? target.innerHTML += text : target.innerHTML = text));\n      def('link', (url) => rts(self.text(url).attr('href', url)));\n      def('clear', () => rts(self.text(''), self.attr('href', null)));\n      def('show', () => self.removeClass('hidden'));\n      def('hide', () => self.addClass('hidden'));\n      def('style', (props) => {\n        if (Array.isArray(props)) {\n          return props.map((p) => target.style[p])\n        } else if (typeof props === 'string') {\n          return target.style[props];\n        } else {\n          for (let prop in props) {\n            target.style[prop] = props[prop];\n          }\n        }\n      });\n      def('on', (type, listener, capture) => rts(target.addEventListener(type, listener, capture)));\n      def('toDom', () => {\n        let root = self.target();\n        for (let e in self) {\n          const elt = self[e];\n          try {\n            if (Array.isArray(elt))\n              elt.forEach((e) => root.appendChild(e.toDom()));\n            else\n              root.appendChild(elt.toDom())\n          }\n          catch (err) {\n            console.warn(e, target, self[e], err);\n          }\n        }\n        return root;\n      });\n    };\n\n    /**\n     * @description \"virtual\" DOM element factory\n     * @param {String} [e] element type\n     * @param {String|Array<String>} [c] class/classes\n     */\n    const $touch = (e = 'div', c) => {\n      let d = new $(document.createElement(e));\n      if (c) d.addClass(c);\n      return d;\n    };\n\n    // Build the \"virtual\" widget\n    const widget = $touch('div', 'widget');\n    const head = widget.head = $touch('div', 'head');\n    head.logo = $touch('div', 'woleet-logo');\n\n    head.x = $touch('div', 'floatright');\n    head.x.receipt = $touch('button', ['receipt-button', 'clickable']).on('click', forceReceipt).text('Drop proof');\n    head.x.reset = $touch('div', ['reset', 'mini-button', 'clickable']).on('click', reset);\n    head.x.cancel = $touch('div', ['cancel', 'mini-button', 'clickable']).on('click', cancelHash);\n\n    const body = widget.body = $touch('div', 'body');\n\n    const hashZone = body.hashZone = $touch('div', 'hashZone');\n    hashZone.hashProgessContainer = $touch('div', 'progressBarContainer');\n    hashZone.percentage = $touch('span').text('Hashing... 0%');\n    const progressBar = hashZone.hashProgessContainer.progressBar = $touch('div', 'progressBar');\n\n    const infoZone = body.infoZone = $touch('div', 'infoZone');\n    infoZone.items = [];\n    defineProperty(infoZone)('addItem', function () {\n      const item = $touch('div', 'infoZoneItem');\n      item.mainTextZone = $touch('div', ['text', 'small']);\n      item.subTextZone = $touch('div', ['text', 'x-small']);\n      item.byTextZone = $touch('span', ['text', 'x-small']).text('by ');\n      item.signTextZone = $touch('a', ['link', 'x-small']);\n      item.identityTextZone = $touch('div', ['text', 'x-small']);\n      item.warnTextZone = $touch('div', ['text', 'x-small', 'warn']);\n      item.on('click', () => selectItem(item, this.items));\n      this.items.push(item);\n      return item;\n    });\n    defineProperty(infoZone)('flush', function () {\n      this.html('');\n      this.items = [];\n      return this;\n    });\n\n    const dropZone = body.dropZone = $touch('div', 'dropZoneContainer');\n    dropZone.inputContainer = $touch('div');\n    dropZone.inputContainer.mainTextZone = $touch('div', ['text', 'small']);\n    dropZone.inputContainer.subTextZone = $touch('div', ['text', 'x-small']);\n    dropZone.inputContainer.input = $touch('input', ['dropZone', 'clickable']).attr('type', 'file').on('change', setInputFile);\n\n    const foot = widget.foot = $touch('div', 'foot');\n    foot.expand = $touch('div', ['expand', 'expand-button', 'clickable']).on('click', expandList);\n\n    init();\n\n    // Simulate a drop if hash is provided\n    if (hash) setInputFile.call({ files: [hash] });\n\n    function init() {\n      resetText();\n      dropZone.inputContainer.mainTextZone.text('Drop the file to verify');\n      infoZone.removeClass(['ok', 'error', 'info']);\n      infoZone.hide();\n      dropZone.show();\n      hashZone.hide();\n      head.x.reset.hide();\n      head.x.cancel.hide();\n      head.x.receipt.hide();\n      foot.hide();\n    }\n\n    function resetText() {\n      dropZone.inputContainer.mainTextZone.clear();\n      dropZone.inputContainer.subTextZone.clear();\n      infoZone.flush();\n    }\n\n    /**\n     * @param {Date} date\n     */\n    function formatDate(date) {\n      let options = { year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric' };\n      return date.toLocaleDateString('en', options)\n    }\n\n    const hasher = new woleet.file.Hasher;\n\n    function setInputFile() {\n      let file = this.files[0];\n      if (!file) return;\n\n      // Set default vue\n      if (state.state === 'done') setVue('init');\n\n      const setProgress = (e) => {\n        let p = (e.progress * 100);\n        if (p !== p) p = 0;\n        p = p.toFixed(0);\n        progressBar.style({ width: p + '%' });\n        hashZone.percentage.text('Hashing... ' + p + '%');\n      };\n\n      // We need a receipt to verify the hash|file\n      if (state.state === 'needReceipt') {\n\n        return parseReceiptFile(file)\n          .then((receipt) => woleet.verify.DAB(state.hash, receipt, setProgress))\n          .then((res) => {\n            if (res.code !== 'verified') {\n              throw new Error(res.code);\n            }\n            setVue('ok', res);\n            state.state = 'done';\n          })\n          .catch((err) => {\n            setVue('error', err);\n          })\n      }\n\n      // We just entered a new hash|file to verify\n      else {\n\n        if (typeof file === 'string') {\n          state.hash = file;\n          return woleetDAB(state.hash);\n        } else {\n\n          setVue('hashing');\n\n          return new Promise((resolve, reject) => {\n            hasher.start(file);\n            hasher.on('progress', setProgress);\n            hasher.on('error', (err) => setVue('error', err.error || err.message));\n            hasher.on('result', (r) => {\n              state.hash = r.result;\n              setProgress({ progress: 0 });\n              resolve(woleetDAB(state.hash));\n            })\n          })\n        }\n\n        function woleetDAB(hash) {\n\n          setVue('pending', 'Verifying proof(s)... ');\n\n          return woleet.verify.WoleetDAB(hash, setProgress)\n            .then((results) => {\n              state.state = 'done';\n              addResults(results.sort((b, a) => a.timestamp > b.timestamp ? -1 : a.timestamp < b.timestamp ? 1 : 0));\n            })\n            .catch((err) => {\n              // As we use cross-domain, it is difficult to know where the error come from,\n              // so we guess that the Woleet API isn't available and set state to need-receipt\n              // if the error came from network\n              if (err.hasOwnProperty('code') || err.message === 'need-receipt') {\n                state.state = 'needReceipt';\n                setVue('need-receipt');\n              } else {\n                setVue('error', err);\n              }\n            })\n        }\n      }\n    }\n\n    function forceReceipt() {\n      resetText();\n      foot.hide();\n      state.state = 'needReceipt';\n      setVue('need-receipt');\n      dropZone.inputContainer.mainTextZone.text('Drop the proof receipt');\n      dropZone.inputContainer.subTextZone.clear();\n    }\n\n    function getDetailedMessage(error) {\n      const detail = {};\n      switch (error) {\n        case 'need-receipt':\n          detail.main = 'No public proof found at Woleet';\n          detail.sub = 'No public proof receipt found at Woleet: you must provide one to verify this file';\n          break;\n        case 'file_matched_but_anchor_not_yet_processed':\n          detail.main = 'The proof is not yet verifiable';\n          detail.sub = 'A public proof receipt has been found at Woleet, but is not yet verifiable (try again later)';\n          break;\n        case 'target_hash_mismatch':\n          detail.main = 'The proof mismatches the file';\n          detail.sub = 'The proof receipt\\'s target hash attribute doesn\\'t match the file hash';\n          break;\n        case 'unable_to_parse_json':\n          detail.main = 'The proof cannot be parsed';\n          detail.sub = 'The file you provided is not a valid Chainpoint 1 or 2 proof receipt';\n          break;\n        case 'merkle_root_mismatch':\n          detail.main = 'The proof is corrupted';\n          detail.sub = 'The proof receipt\\'s merkle root attribute does not match the proof result';\n          break;\n        case 'non_sha256_target_proof_element':\n          detail.main = 'The proof is corrupted';\n          detail.sub = 'An attribute in the proof (parent or left or right) in not a SHA256 hash';\n          break;\n        case 'invalid_parent_in_proof_element':\n          detail.main = 'The proof is corrupted';\n          detail.sub = 'A parent in the proof is not the SHA256 of its children';\n          break;\n        case 'invalid_receipt_format':\n          detail.main = 'The proof is corrupted';\n          detail.sub = 'The proof receipt does not conform to the Chainpoint 1 or 2 format';\n          break;\n        case 'invalid_target_proof':\n          detail.main = 'The proof is corrupted';\n          detail.sub = 'The proof receipt\\'s merkle proof attribute is invalid';\n          break;\n        case 'op_return_mismatches_merkle_root':\n          detail.main = 'The receipt is corrupted';\n          detail.sub = 'The transaction\\'s OP_RETURN mismatches the proof receipt\\'s merkle root';\n          break;\n        case 'http_error':\n          detail.main = 'Unexpected HTTP error';\n          detail.sub = 'An unexpected HTTP error occurred during the verification process';\n          break;\n        case 'tx_not_found':\n          detail.main = 'The transaction cannot be found';\n          detail.sub = 'The proof receipt\\'s transaction doesn\\'t exist in the blockchain';\n          break;\n        case 'tx_not_confirmed':\n          detail.main = 'The transaction is not confirmed';\n          detail.sub = 'The proof receipt\\'s transaction is not yet confirmed by the blockchain';\n          break;\n        case 'invalid_receipt_signature':\n          detail.main = 'The signature is invalid';\n          detail.sub = 'The proof receipt\\'s signature is not valid';\n          break;\n        case 'invalid_receipt_signature_format':\n          detail.main = 'The signature is corrupted';\n          detail.sub = 'The proof receipt does not conform to the Chainpoint 1 or 2 format with signature extension';\n          break;\n        case 'file_too_big_to_be_hashed_without_worker':\n          detail.main = 'Cannot hash without worker';\n          detail.sub = 'The file is too big to be hashed without worker';\n          break;\n        default:\n          console.trace('unexpected case', error);\n          detail.main = error;\n          detail.sub = 'Unexpected case';\n          break;\n      }\n      return detail;\n    }\n\n    function addResults(results) {\n      resetText();\n      if (results.length) {\n\n        if (results.length > 1) {\n          foot.expand.text(results.length + '+');\n          foot.expand.removeClass('up-arrow');\n          foot.show();\n        }\n\n        results.forEach((res, i) => {\n          if (res.code === 'verified') {\n            addVue('ok', res, i);\n          } else {\n            addVue('error', res.code, i);\n          }\n        });\n        infoZone.toDom();\n      } else {\n        state.state = 'needReceipt';\n        setVue('need-receipt');\n      }\n    }\n\n    function addVue(vue, message, index) {\n      infoZone.show();\n      const item = infoZone.addItem();\n      item.addClass(index ? 'reduced' : 'expanded');\n      dropZone.hide();\n      hashZone.hide();\n      head.x.cancel.hide();\n      switch (vue) {\n        case 'ok':\n          const sig = message.receipt.signature;\n          const pubKey = sig ? sig.pubKey : null;\n\n          // Timestamp\n          if (!message.confirmations) {\n            item.mainTextZone.text('Proof not yet verifiable');\n            item.subTextZone.text('The proof receipt\\'s transaction is not yet confirmed (try again later)');\n            item.addClass('info');\n          } else {\n            const date = formatDate(message.timestamp);\n            item.mainTextZone.text(`${pubKey ? 'Signed' : 'Timestamped'} on ${date}`);\n            item.addClass('ok');\n          }\n\n          // Identity\n          const idStatus = message.identityVerificationStatus;\n          const identity = idStatus ? Object.assign({}, idStatus.signedIdentity, idStatus.identity) : null;\n          if (idStatus && idStatus.code === 'verified' && identity) {\n            item.byTextZone.addClass('link');\n            if (sig.identityURL)\n              item.signTextZone.link(`${sig.identityURL}?pubKey=${pubKey}&leftData=random`\n                + (sig.signedIdentity ? `&signedIdentity=${encodeURIComponent(sig.signedIdentity)}` : ''));\n            if (identity && identity.commonName) {\n              item.signTextZone.text(`${identity.commonName}`);\n              item.identityTextZone.html(\n                `${identity.organization || ''}${identity.organization && identity.organizationalUnit ? ' - ' : ''}${identity.organizationalUnit || ''}<br>\n                 ${identity.locality || ''}${identity.locality && identity.country ? ' - ' : ''}${identity.country || ''}`\n              );\n            } else {\n              item.signTextZone.text(`${sig.identityURL}`);\n            }\n            item.byTextZone.show();\n          } else if (pubKey) {\n            item.signTextZone.text(`${pubKey}`);\n            item.byTextZone.show();\n          } else {\n            item.byTextZone.hide();\n          }\n          if (idStatus && idStatus.code && idStatus.code !== 'verified') {\n            item.warnTextZone.text(`Cannot verify identity (${idStatus.code})`)\n          }\n\n          dropZone.attr('disabled', true);\n          head.x.receipt.show();\n          break;\n        case 'error':\n          if (state.state === 'needReceipt') head.x.receipt.show();\n          const error = (message instanceof Error) ? message.message : message;\n          const detail = getDetailedMessage(error);\n          item.mainTextZone.text(detail.main);\n          item.subTextZone.text(detail.sub);\n          item.byTextZone.hide();\n          item.warnTextZone.hide();\n          item.addClass(error !== 'file_matched_but_anchor_not_yet_processed' ? 'error' : 'info');\n          break;\n      }\n      head.x.reset.show();\n    }\n\n    function setVue(vue, message) {\n      switch (vue) {\n        case 'ok':\n          resetText();\n          addVue('ok', message, 0);\n          infoZone.toDom();\n          break;\n        case 'need-receipt':\n          resetText();\n          infoZone.hide();\n          dropZone.show();\n          hashZone.hide();\n          head.x.cancel.hide();\n          head.x.receipt.hide();\n          dropZone.inputContainer.mainTextZone.text('No public proof found at Woleet');\n          dropZone.inputContainer.subTextZone.text('Please provide a proof receipt');\n          head.x.reset.show();\n          break;\n        case 'error':\n          resetText();\n          addVue('error', message, 0);\n          infoZone.toDom();\n          break;\n        case 'hashing':\n          resetText();\n          head.x.cancel.show();\n          head.x.receipt.hide();\n          infoZone.hide();\n          dropZone.hide();\n          hashZone.show();\n          break;\n        case 'pending':\n          resetText();\n          infoZone.hide();\n          dropZone.show();\n          hashZone.hide();\n          head.x.cancel.hide();\n          head.x.receipt.hide();\n          dropZone.inputContainer.mainTextZone.text(message);\n          head.x.reset.show();\n          break;\n        case 'init':\n        default:\n          init();\n          break;\n      }\n    }\n\n    function parseReceiptFile(receipt) {\n      return new Promise((resolve, reject) => {\n        let reader = new FileReader();\n        reader.onloadend = (e) => {\n          try {\n            resolve(JSON.parse(e.target.result));\n          }\n          catch (err) {\n            reject(new Error('unable_to_parse_json'));\n          }\n        };\n        reader.readAsText(receipt);\n      });\n    }\n\n    let expanded = false;\n    let selected = null;\n\n    function selectItem(item, items) {\n      if (!expanded) return;\n\n      if (selected === item) {\n        // Clicked on item for the second time\n        return expandList();\n      }\n\n      selected = item;\n\n      items.forEach((item) => {\n        item.removeClass('expanded');\n        item.addClass('reduced');\n      });\n\n      item.addClass('expanded');\n      item.removeClass('reduced');\n    }\n\n    function expandList() {\n      const items = infoZone.items;\n      if (expanded) {\n        body.removeClass('expanded');\n        items.forEach((item) => item.removeClass('clickable'));\n        foot.expand.text(items.length + \"+\");\n        foot.expand.removeClass(\"up-arrow\");\n        expanded = false;\n      } else {\n        body.addClass('expanded');\n        items.forEach((item) => item.addClass('clickable'));\n        foot.expand.text('');\n        foot.expand.addClass('up-arrow');\n        expanded = true;\n      }\n    }\n\n    function reset() {\n      setVue('init');\n      hasher.cancel();\n      state.hash = null;\n      state.state = 'initial'\n    }\n\n    function cancelHash() {\n      reset();\n    }\n\n    this.setInputFile = (file) => {\n      if (state.state === 'needReceipt')\n        throw new Error('Current state is needReceipt');\n      const ctx = { files: [file] };\n      return setInputFile.call(ctx);\n    };\n\n    this.setReceipt = (file) => {\n      forceReceipt();\n      if (state.state !== 'needReceipt')\n        throw new Error('Current state must be needReceipt');\n      const ctx = { files: [file] };\n      return setInputFile.call(ctx);\n    };\n\n    this.reset = reset;\n\n    this.cancelHash = cancelHash;\n\n    this.toDom = () => widget.toDom();\n  }\n\n  document.addEventListener(\"DOMContentLoaded\", () => {\n    let widgets = document.getElementsByClassName(\"woleet-widget\");\n    for (let i = 0; i < widgets.length; i++) {\n      let e = widgets[i];\n      let hash = e.getAttribute(\"data-hash\");\n      const widget = new Widget(hash);\n      e.appendChild(widget.toDom());\n    }\n  });\n\n  root.Widget = Widget;\n\n}(window));\n"],"file":"woleet-widget.min.js"}