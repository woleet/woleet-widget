{"version":3,"sources":["woleet-widget.js"],"names":["root","Widget","hash","head","receipt","body","dropZone","inputContainer","mainTextZone","text","hashZone","hashProgessContainer","percentage","progressBar","reset","hide","infoZone","icon","$touch","signTextZone","warnTextZone","subTextZone","formatDate","setInputFile","day","month","year","hour","minutes","resetText","removeClass","show","getMinutes","join","state","setVue","setProgress","e","progress","p","width","getMonth","date","file","woleet","verify","DAB","then","res","catch","err","parseReceiptFile","result","code","length","Error","console","message","Number","isNaN","toFixed","style","woleetDAB","hasher","detail","sub","main","forceReceipt","getErrorMessage","signature","i","identityVerificationStatus","pubKey","s","identityURL","timestamp","split","timeZone","exec","toString","trace","signee","addClass","attr","vue","cancel","init","reject","reader","onloadend","parse","target","cancelHash","$","element","classes","Element","createElement","TypeError","rts","this","self","def","name","value","Object","defineProperty","enumerable","Array","isArray","forEach","classList","remove","add","innerText","props","prop","val","setAttribute","removeAttribute","type","listener","capture","addEventListener","toDom","d","c","widget","appendChild","on","document","input","call","files","Hasher","resolve","widgets","getAttribute"],"mappings":"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","file":"woleet-widget.min.js","sourcesContent":["(function (root) {\n\n    /**\n     * @param [hash]\n     * @constructor\n     */\n    function Widget(hash) {\n\n        // Check parameter\n        if (hash && typeof hash !== 'string')\n            throw new Error('Invalid parameter type');\n\n        // Init state\n        const state = {\n            state: 'initial',\n            hash: null\n        };\n\n        /**\n         * @typedef {{\n         *      target:function(),\n         *      addClass: function(string[]|string):$,\n         *      removeClass: function(string[]|string):$,\n         *      show: function():$,\n         *      hide: function():$,\n         *      text: function(text: string, add?: boolean):$,\n         *      style: function(props: object),\n         *      attr: function(attr: string, val: *),\n         *      on: function(type: string, listener:function, capture: boolean),\n         *      toDom: function()\n         *      }} $\n         */\n\n        /**\n         * @description \"virtual\" DOM element Object\n         * @param {Element|string} element\n         * @param {string|string[]} [classes]\n         * @private\n         */\n        const $ = function (element, classes) {\n\n            if (element instanceof Element) {\n\n            } else if (typeof element === 'string') {\n                let element = document.createElement(element);\n                if (classes) element.addClass(classes);\n            } else {\n                throw new TypeError\n            }\n\n            const target = element;\n            /**\n             * @type {$}\n             */\n            const self = this;\n            const rts = () => self;\n            const def = (name, value) => Object.defineProperty(self, name, {enumerable: false, value});\n\n            def('target', () => target);\n            def('removeClass', (e) => rts(Array.isArray(e) ? e.forEach(e => target.classList.remove(e)) : target.classList.remove(e)));\n            def('addClass', (e) => rts(Array.isArray(e) ? e.forEach(e => target.classList.add(e)) : target.classList.add(e)));\n            def('text', (text, add) => rts(add ? target.innerText += text : target.innerText = text));\n            def('show', () => self.removeClass('hidden'));\n            def('hide', () => self.addClass('hidden'));\n            def('style', (props) => {\n                if (Array.isArray(props)) {\n                    return props.map((p) => target.style[p])\n                }\n                else if (typeof props === 'string') return target.style[props];\n                else {\n                    for (let prop in props) {\n                        //noinspection JSUnfilteredForInLoop\n                        target.style[prop] = props[prop];\n                    }\n                }\n            });\n            def('attr', (attr, val) => rts(val ? target.setAttribute(attr, val) : target.removeAttribute(attr)));\n            def('on', (type, listener, capture) => rts(target.addEventListener(type, listener, capture)));\n            def('toDom', () => {\n                let root = self.target();\n                for (let e in self) {\n                    if (!self.hasOwnProperty(e)) continue;\n                    if (!e instanceof $) continue;\n                    try {\n                        root.appendChild(self[e].toDom())\n                    } catch (err) {\n                        console.log(e, err);\n                    }\n                }\n                return root;\n            });\n        };\n\n        /**\n         * @description \"virtual\" DOM element factory\n         * @param {String} [e] element type\n         * @param {String|Array<String>} [c] class/classes\n         */\n        const $touch = (e = 'div', c) => {\n            let d = new $(document.createElement(e));\n            if (c) d.addClass(c);\n            return d;\n        };\n\n        // Build the \"virtual\" widget\n        const widget = $touch('div', 'widget');\n        const head = widget.head = $touch('div', 'head');\n        head.logo = $touch('div', 'woleet-logo');\n        head.reset = $touch('div', ['reset', 'mini-button', 'clickable']).on('click', reset);\n        head.cancel = $touch('div', ['cancel', 'mini-button', 'clickable']).on('click', cancelHash);\n        head.receipt = $touch('button', ['receipt-button', 'clickable']).on('click', forceReceipt).text('Drop receipt');\n        const body = widget.body = $touch('div', 'body');\n\n        const hashZone = body.hashZone = $touch('div', 'hashZone');\n        hashZone.hashProgessContainer = $touch('div', 'progressBarContainer');\n        hashZone.percentage = $touch('span').text('Hashing... 0%');\n        const progressBar = hashZone.hashProgessContainer.progressBar = $touch('div', 'progressBar');\n\n        const infoZone = body.infoZone = $touch('div', 'infoZone');\n        infoZone.icon = $touch('div', 'infoStatus');\n        infoZone.mainTextZone = $touch('div', 'text');\n        infoZone.subTextZone = $touch('div', ['text', 'small']);\n        infoZone.signTextZone = $touch('div', ['text', 'x-small']);\n        infoZone.warnTextZone = $touch('div', ['text', 'x-small', 'warn']);\n\n        const dropZone = body.dropZone = $touch('div', 'dropZoneContainer');\n        dropZone.inputContainer = $touch('div');\n        dropZone.inputContainer.mainTextZone = $touch('div', 'text');\n        dropZone.inputContainer.subTextZone = $touch('div', ['text', 'small']);\n        dropZone.inputContainer.input = $touch('input', ['dropZone', 'clickable']).attr('type', 'file').on('change', setInputFile);\n\n        init();\n\n        // Simulate a drop if hash is provided\n        if (hash) setInputFile.call({files: [hash]});\n\n        function init() {\n            resetText();\n            dropZone.inputContainer.mainTextZone.text('Drop the file to verify');\n            infoZone.removeClass(['validated', 'error']);\n            infoZone.hide();\n            dropZone.show();\n            hashZone.hide();\n            head.reset.hide();\n            head.cancel.hide();\n            head.receipt.hide();\n        }\n\n        function resetText() {\n            dropZone.inputContainer.mainTextZone.text('');\n            dropZone.inputContainer.subTextZone.text('');\n            infoZone.mainTextZone.text('');\n            infoZone.subTextZone.text('');\n            infoZone.signTextZone.text('');\n            infoZone.warnTextZone.text('');\n        }\n\n        /**\n         * @param {Date} date\n         */\n        function formatDate(date) {\n            let day, month, year, hour, minutes;\n\n            day = date.getDate();\n            month = date.getMonth();\n            year = date.getFullYear();\n            hour = date.getHours();\n            minutes = date.getMinutes();\n\n            return [day, month + 1, year].join('/') + ' ' + [hour, minutes].join(':');\n        }\n\n        const hasher = new woleet.file.Hasher;\n\n        function setInputFile() {\n            let file = this.files[0];\n            if (!file) return;\n\n            // Reset input\n            //noinspection JSUnusedGlobalSymbols\n            this.value = null;\n\n            // Set default vue\n            if (state.state === 'done') setVue('init');\n\n            const setProgress = (e) => {\n                let p = (e.progress * 100);\n                if (Number.isNaN(p)) p = 0;\n                p = p.toFixed(0);\n                progressBar.style({width: p + '%'});\n                hashZone.percentage.text('Hashing... ' + p + '%')\n            };\n\n            // We need a receipt to verify the hash|file\n            if (state.state === 'needReceipt') {\n                setVue('pending');\n                parseReceiptFile(file)\n                    .then((receipt) => woleet.verify.DAB(state.hash, receipt, setProgress))\n                    .then((res) => {\n                        if (res.code !== 'verified') throw new Error(res.code);\n                        setVue('woleet-ok', res);\n                        state.state = 'done';\n                    })\n                    .catch((err) => {\n                        setVue('error', err);\n                    })\n            }\n\n            // We just entered a new hash|file to verify\n            else {\n\n                setVue('pending');\n\n                if (typeof file === 'string') {\n                    state.hash = file;\n                    woleetDAB(state.hash);\n                } else {\n                    hasher.start(file);\n                    hasher.on('progress', setProgress);\n                    hasher.on('result', (r) => {\n                        state.hash = r.result;\n                        woleetDAB(state.hash);\n                        setProgress({progress: 0});\n                    })\n                }\n\n                function woleetDAB(hash) {\n                    woleet.verify.WoleetDAB(hash, setProgress)\n                        .then((result) => {\n                            if (result.length) {\n                                state.state = 'done';\n                                const res = result[0];\n                                if (res.code !== 'verified') throw new Error(res.code);\n                                setVue('woleet-ok', res);\n                            }\n                            else throw new Error('need-receipt');\n                        })\n                        .catch((err) => {\n                            // As we use cross-domain, it is difficult to know where the error come from,\n                            // so we guess that the Woleet API isn't available and set state to need-receipt\n                            // if the error came from network\n                            console.log(err);\n                            if (err.hasOwnProperty('code') || err.message === 'need-receipt') {\n                                state.state = 'needReceipt';\n                                setVue('need-receipt');\n                            }\n                            else {\n                                setVue('error', err);\n                            }\n                        })\n                }\n            }\n        }\n\n        function forceReceipt() {\n            state.state = 'needReceipt';\n            setVue('need-receipt');\n            dropZone.inputContainer.mainTextZone.text('Drop file\\'s receipt');\n            dropZone.inputContainer.subTextZone.text('');\n        }\n\n        function getErrorMessage(err) {\n            if (err instanceof Error) {\n                err = err.message;\n            }\n            const detail = {};\n            switch (err) {\n                case 'need-receipt':\n                    detail.main = 'File unknown to Woleet';\n                    detail.sub = 'The receipt cannot be retreived from Woleet: you must provide it to verify this file';\n                    break;\n                case 'target_hash_mismatch':\n                    detail.main = 'The provided receipt is not meant for this file';\n                    detail.sub = 'The receipt\\'s target_hash attribute doesn\\'t match the file hash';\n                    break;\n                case 'unable_to_parse_json':\n                    detail.main = 'The provided receipt cannot be parsed';\n                    detail.sub = 'The file you provided doesn\\'t look like a receipt';\n                    break;\n                case 'merkle_root_mismatch':\n                    detail.main = 'The provided receipt seems corrupted';\n                    detail.sub = 'The receipt\\'s merkle_root attribute does not match the proof result';\n                    break;\n                case 'non_sha256_target_proof_element':\n                    detail.main = 'The provided receipt seems corrupted';\n                    detail.sub = 'An attribute in the proof (parent or left or right) in not a SHA256 hash';\n                    break;\n                case 'invalid_parent_in_proof_element':\n                    detail.main = 'The provided receipt seems corrupted';\n                    detail.sub = 'A parent in the proof does not match SHA256(left+right).';\n                    break;\n                case 'invalid_receipt_format':\n                    detail.main = 'The provided receipt seems corrupted';\n                    detail.sub = 'The proof miss an attribute (parent or left or right).';\n                    break;\n                case 'invalid_target_proof':\n                    detail.main = 'The provided receipt seems corrupted';\n                    detail.sub = 'The receipt does not conform to the Chainpoint 1.x format';\n                    break;\n                case 'tx_not_found':\n                    detail.main = 'Transaction not found';\n                    detail.sub = 'The transaction targeted by the receipt cannot be found';\n                    break;\n                case 'invalid_receipt_signature':\n                    detail.main = 'Invalid receipt signature';\n                    detail.sub = 'The provided receipt is packed with a signature field witch is invalid';\n                    break;\n                case 'error_while_getting_transaction':\n                    detail.main = 'Cannot get transaction';\n                    detail.sub = 'There was an error while getting the transaction (try again)';\n                    break;\n                default:\n                    console.trace('unexpected case', err);\n                    detail.main = err;\n                    detail.sub = 'unexpected case';\n                    break;\n            }\n            return detail;\n        }\n\n        function setVue(vue, message) {\n            switch (vue) {\n                case 'woleet-ok':\n                    resetText();\n                    infoZone.removeClass(['error']);\n                    infoZone.show();\n                    dropZone.hide();\n                    hashZone.hide();\n                    head.cancel.hide();\n                    const s = message.receipt.signature;\n                    const i = message.identityVerificationStatus;\n                    const pubKey = s ? s.pubKey : null;\n                    const signee = (s && s.identityURL && i && i.code === 'verified') ? s.identityURL : pubKey;\n                    const date = formatDate(message.timestamp).split(' ');\n                    const timeZone = /.*(GMT.*\\)).*/.exec(message.timestamp.toString())[1];\n                    infoZone.mainTextZone.text(`${pubKey ? 'Signed' : 'Timestamped'} on ${date[0]}`);\n                    infoZone.subTextZone.text('at ' + date[1] + ' ' + timeZone);\n                    infoZone.signTextZone.text(pubKey ? `by ${signee}` : '');\n                    if (i && i.code && i.code !== 'verified') {\n                        infoZone.warnTextZone.text(`Cannot validate identity (${i.code})`)\n                    }\n                    infoZone.addClass('validated');\n                    dropZone.attr('disabled', true);\n                    head.reset.show();\n                    head.receipt.show();\n                    break;\n                case 'need-receipt':\n                    resetText();\n                    infoZone.hide();\n                    dropZone.show();\n                    hashZone.hide();\n                    head.cancel.hide();\n                    head.receipt.hide();\n                    dropZone.inputContainer.mainTextZone.text('File unknown to Woleet');\n                    dropZone.inputContainer.subTextZone.text('Drop it\\'s receipt');\n                    head.reset.show();\n                    break;\n                case 'error':\n                    resetText();\n                    infoZone.removeClass(['validated']);\n                    infoZone.show();\n                    dropZone.hide();\n                    hashZone.hide();\n                    head.cancel.hide();\n                    if(state.state === 'needReceipt') head.receipt.show();\n                    let detail = getErrorMessage(message);\n                    infoZone.mainTextZone.text(detail.main);\n                    infoZone.subTextZone.text(detail.sub);\n                    infoZone.addClass('error');\n                    head.reset.show();\n                    break;\n                case 'pending':\n                    resetText();\n                    head.cancel.show();\n                    head.receipt.hide();\n                    infoZone.hide();\n                    dropZone.hide();\n                    hashZone.show();\n                    break;\n                case 'init':\n                default:\n                    init();\n                    break;\n            }\n        }\n\n        function parseReceiptFile(receipt) {\n            return new Promise((resolve, reject) => {\n                let reader = new FileReader();\n                reader.onloadend = (e) => {\n                    try {\n                        //noinspection JSUnresolvedVariable\n                        resolve(JSON.parse(e.target.result));\n                    } catch (err) {\n                        reject(new Error('unable_to_parse_json'));\n                    }\n                };\n                reader.readAsText(receipt);\n            });\n        }\n\n        function reset() {\n            setVue('init');\n            state.hash = null;\n            state.state = 'initial'\n        }\n\n        function cancelHash() {\n            hasher.cancel();\n            reset();\n        }\n\n        return widget.toDom()\n    }\n\n    document.addEventListener(\"DOMContentLoaded\", () => {\n        let widgets = document.getElementsByClassName(\"woleet-widget\");\n        for (let i = 0; i < widgets.length; i++) {\n            let e = widgets[i];\n            let hash = e.getAttribute(\"data-hash\");\n            e.appendChild(new Widget(hash));\n        }\n    });\n\n    root.Widget = Widget;\n\n}(window));"]}