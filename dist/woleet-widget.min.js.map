{"version":3,"sources":["woleet-widget.js"],"names":["root","Widget","hash","content","info","dropZone","buttonBox","button","tooltip","textZone","$touch","message","text","mainTextZone","show","subTextZone","hide","inputContainer","progressBarContainer","progressBar","formatDate","setInputFile","day","month","year","hour","minutes","getFullYear","removeClass","join","file","this","files","setVue","getMonth","date","getMinutes","woleet","verify","DAB","state","receipt","e","style","width","progress","then","res","confirmedOn","catch","err","WoleetDAB","parseReceiptFile","Error","hasOwnProperty","tip","vue","setTooltip","parseError","error","addClass","head","reset","icon","split","attr","Promise","resolve","reject","reader","FileReader","init","$","domElement","_this","_target","target","Array","forEach","classList","remove","isArray","add","innerText","props","map","p","propName","val","removeAttribute","on","type","listener","capture","addEventListener","toDom","iniProps","setAttribute","indexOf","appendChild","console","log","c","d","document","createElement","widget","logo","body","input","widgets","getElementsByClassName","i","length","readAsText","getAttribute","window"],"mappings":"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","file":"woleet-widget.min.js","sourcesContent":["(function (root) {\n\n    /**\n     * @param [hash]\n     * @constructor\n     */\n    function Widget(hash) {\n\n        // Check parameter\n        if (hash && typeof hash != 'string')\n            throw new Error('Invalid parameter type');\n\n        // Init state\n        const state = {\n            state: 'initial',\n            hash: null\n        };\n\n        /**\n         * @description \"virtual\" DOM element Object\n         * @param domElement\n         */\n        const $ = function (domElement) {\n            let _target = domElement;\n            this.target = () => _target;\n\n            this.removeClass = (e) => {\n                Array.isArray(e) ? e.forEach(e => _target.classList.remove(e)) : _target.classList.remove(e);\n                return this;\n            };\n\n            this.addClass = (e) => {\n                Array.isArray(e) ? e.forEach(e => _target.classList.add(e)) : _target.classList.add(e);\n                return this;\n            };\n\n            this.text = (text, add) => {\n                add ? _target.innerText += text : _target.innerText = text;\n                return this;\n            };\n\n            this.show = () => this.removeClass('hidden');\n\n            this.hide = () => this.addClass('hidden');\n\n            this.style = (props) => {\n                if (Array.isArray(props)) {\n                    return props.map((p) => _target.style[p])\n                }\n                else if (typeof props == 'string') return _target.style[props];\n                else {\n                    for (let propName in props) {\n                        //noinspection JSUnfilteredForInLoop\n                        _target.style[propName] = props[propName];\n                    }\n                }\n            };\n\n            this.attr = (attr, val) => {\n                val ? _target.setAttribute(attr, val) : _target.removeAttribute(attr);\n                return this;\n            };\n\n            this.on = (type, listener, capture) => {\n                _target.addEventListener(type, listener, capture);\n                return this;\n            };\n\n            this.toDom = () => {\n                const iniProps = ['target', 'text', 'show', 'hide', 'toDom', 'addClass', 'removeClass', 'attr', 'on', 'style'];\n                let root = this.target();\n                for (let e in this) {\n                    if (!this.hasOwnProperty(e)) continue;\n                    if (iniProps.indexOf(e) != -1) continue;\n                    if (!e instanceof $) continue;\n                    try {\n                        root.appendChild(this[e].toDom())\n                    } catch (err) {\n                        console.log(e, err);\n                    }\n                }\n                return root;\n            }\n        };\n\n        /**\n         * @description \"virtual\" DOM element factory\n         * @param {String} [e] element type\n         * @param {String|Array<String>} [c] class/classes\n         * @returns $\n         */\n        const $touch = (e = 'div', c) => {\n            let d = new $(document.createElement(e));\n            if (c) d.addClass(c);\n            return d;\n        };\n\n        // Build the \"virtual\" widget\n        const widget = $touch('div', 'widget');\n        const head = widget.head = $touch('div', 'head');\n        head.logo = $touch('div', 'woleet-logo');\n        head.reset = $touch('div', ['reset-button', 'clickable']).on('click', reset);\n        widget.body = $touch();\n        const content = widget.body.content = $touch();\n        content.icon = $touch('div', 'infoStatus');\n        content.info = $touch('div', 'infoBox');\n        content.info.message = $touch('div', 'messageBox');\n        content.info.message.buttonBox = $touch('div', 'buttonBox');\n        content.info.message.buttonBox.button = $touch('div', ['info', 'tooltip', 'clickable']);\n        content.info.message.buttonBox.button.tooltip = $touch('span', ['tooltiptext']);\n        content.info.message.textZone = $touch('div', 'text');\n        content.dropZone = $touch('div', 'dropZoneContainer');\n        content.dropZone.mainTextZone = $touch('div', 'text');\n        content.dropZone.subTextZone = $touch('div', ['text', 'little']);\n        content.dropZone.inputContainer = $touch('div', 'subContainer');\n        content.dropZone.inputContainer.progressBarContainer = $touch('div').hide();\n        const progressBar = content.dropZone.inputContainer.progressBarContainer.progressBar = $touch('div', 'progressBar');\n        content.dropZone.inputContainer.input = $touch('input', ['dropZone', 'clickable']).attr('type', 'file').on('change', setInputFile);\n\n        init();\n\n        // Simulate a drop if hash is provided\n        if (hash) setInputFile.call({files: [hash]});\n\n        function init() {\n            content.dropZone.mainTextZone.text('Drop the file to verify');\n            content.dropZone.subTextZone.text('');\n            content.info.message.buttonBox.button.tooltip.text('');\n            content.dropZone.addClass('expanded').show();\n            content.info.removeClass(['reduced', 'expanded']).hide();\n            content.icon.removeClass(['validated', 'error']).hide();\n            content.dropZone.inputContainer.progressBarContainer.hide();\n            head.reset.hide();\n        }\n\n        /**\n         * @param {Date} date\n         */\n        function formatDate(date) {\n            let day, month, year, hour, minutes;\n\n            day = date.getDate();\n            month = date.getMonth();\n            year = date.getFullYear();\n            hour = date.getHours();\n            minutes = date.getMinutes();\n\n            return [day, month + 1, year].join('/') + ' ' + [hour, minutes].join(':');\n        }\n\n        function setInputFile() {\n            let file = this.files[0];\n            if (!file) return;\n\n            // Reset input\n            //noinspection JSUnusedGlobalSymbols\n            this.value = null;\n\n            // Set default vue\n            if (state.state == 'done') setVue();\n\n            // We need a receipt to verify the hash|file\n            if (state.state == 'needReceipt') {\n                setVue('pending');\n                parseReceiptFile(file)\n                    .then((receipt) =>\n                        woleet.verify.DAB(state.hash, receipt, (e) => {\n                            progressBar.style({width: e.progress * 100 + '%'})\n                        }))\n                    .then((res) => {\n                        setVue('woleet-ok', formatDate(res.confirmedOn));\n                        state.state = 'done';\n                    })\n                    .catch((err) => {\n                        setVue('error', err);\n                    })\n            }\n\n            // We just entered a new hash|file to verify\n            else {\n                state.hash = file;\n                setVue('pending');\n                woleet.verify.WoleetDAB(file, (e) => {\n                    progressBar.style({width: e.progress * 100 + '%'});\n                }).then((res) => {\n                    if (res.length) {\n                        state.state = 'done';\n                        setVue('woleet-ok', formatDate(res[0].confirmedOn));\n                    }\n                    else throw new Error('need-receipt');\n                }).catch((err) => {\n                    // As we use cross-domain, it is difficult to know where the error come from,\n                    // so we guess that the Woleet API isn't available and set state to need-receipt\n                    // if the error came from network\n                    if (err.hasOwnProperty('code') || err.message == 'need-receipt') {\n                        state.state = 'needReceipt';\n                        setVue('need-receipt', 'Drop its receipt');\n                    }\n                    else {\n                        setVue('error', err);\n                    }\n                })\n            }\n        }\n\n        function setTooltip(vue) {\n            let tip = content.info.message.buttonBox.button.tooltip;\n            let info = content.info.message.textZone;\n            switch (vue) {\n                case 'need-receipt':\n                    info.text('File unknown to Woleet');\n                    tip.text('The receipt cannot be retreived from Woleet: you must provide it to verify this file');\n                    break;\n                case 'target_hash_mismatch':\n                    info.text('The provided receipt is not meant for this file');\n                    tip.text('The receipt\\'s target_hash attribute doesn\\'t match the file hash');\n                    break;\n                case 'unable_to_parse_json':\n                    info.text('The provided receipt cannot be parsed');\n                    tip.text('The file you provided doesn\\'t look like a receipt');\n                    break;\n                case 'merkle_root_mismatch':\n                    info.text('The provided receipt seems corrupted');\n                    tip.text('The receipt\\'s merkle_root attribute does not match the proof result');\n                    break;\n                case 'non_sha256_target_proof_element':\n                    info.text('The provided receipt seems corrupted');\n                    tip.text('An attribute in the proof (parent or left or right) in not a SHA256 hash');\n                    break;\n                case 'invalid_parent_in_proof_element':\n                    info.text('The provided receipt seems corrupted');\n                    tip.text('A parent in the proof does not match SHA256(left+right).');\n                    break;\n                case 'invalid_receipt_format':\n                    info.text('The provided receipt seems corrupted');\n                    tip.text('The proof miss an attribute (parent or left or right).');\n                    break;\n                case 'invalid_target_proof':\n                    info.text('The provided receipt seems corrupted');\n                    tip.text('The receipt does not conform to the Chainpoint 1.x format');\n                    break;\n                case 'tx_not_found':\n                    info.text('Transaction not found');\n                    tip.text('The transaction targeted by the receipt cannot be found');\n                    break;\n                case 'error_while_getting_transaction':\n                    info.text('Cannot get transaction');\n                    tip.text('There was an error while getting the transaction (try again)');\n                    break;\n                default:\n                    info.text(vue);\n                    tip.text('unexpected case');\n                    break;\n            }\n        }\n\n        // Same role as setVue, but error-specific\n        function parseError(error) {\n            console.error(error.message);\n            let message = error.message || \"Something bad happened\";\n            content.info.removeClass('reduced').addClass('expanded').show();\n            content.dropZone.inputContainer.progressBarContainer.hide();\n            content.icon.addClass('error').show();\n            content.dropZone.removeClass('expanded').hide();\n            head.reset.show();\n            setTooltip(message);\n        }\n\n        function setVue(vue, message) {\n            switch (vue) {\n                case 'woleet-ok':\n                case 'receipt-ok':\n                    content.icon.show();\n                    let date = message.split(' ');\n                    content.dropZone.mainTextZone.text(date[0]);\n                    content.dropZone.subTextZone.text(date[1]);\n                    content.dropZone.removeClass('expanded');\n                    content.icon.addClass('validated');\n                    content.info.removeClass('reduced').hide();\n                    content.dropZone.inputContainer.progressBarContainer.hide();\n                    content.dropZone.attr('disabled', true);\n                    setTooltip('');\n                    break;\n                case 'need-receipt':\n                    content.dropZone.mainTextZone.text(message);\n                    content.dropZone.removeClass('expanded');\n                    content.info.message.textZone.text('need receipt');\n                    content.info.addClass('reduced').show();\n                    content.dropZone.inputContainer.progressBarContainer.hide();\n                    head.reset.show();\n                    setTooltip('need-receipt');\n                    break;\n                case 'receipt-ko':\n                case 'error':\n                    parseError(message);\n                    break;\n                case 'pending':\n                    content.info.hide();\n                    content.icon.hide();\n                    content.dropZone.mainTextZone.text('Hashing...');\n                    content.dropZone.inputContainer.progressBarContainer.show();\n                    setTooltip('');\n                    break;\n                case 'init':\n                default:\n                    init();\n                    break;\n            }\n        }\n\n        function parseReceiptFile(receipt) {\n            return new Promise(function (resolve, reject) {\n                let reader = new FileReader();\n                reader.onloadend = function (e) {\n                    try {\n                        //noinspection JSUnresolvedVariable\n                        resolve(JSON.parse(e.target.result));\n                    } catch (err) {\n                        reject(new Error('unable_to_parse_json'));\n                    }\n                };\n                reader.readAsText(receipt);\n            });\n        }\n\n        function reset() {\n            setVue('init');\n            state.hash = null;\n            state.state = 'initial'\n        }\n\n        return widget.toDom()\n    }\n\n    document.addEventListener(\"DOMContentLoaded\", () => {\n        let widgets = document.getElementsByClassName(\"woleet-widget\");\n        for (let i = 0; i < widgets.length; i++) {\n            let e = widgets[i];\n            let hash = e.getAttribute(\"data-hash\");\n            e.appendChild(new Widget(hash));\n        }\n    });\n\n    root.Widget = Widget;\n\n}(window));"]}