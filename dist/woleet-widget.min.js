"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(e,t){function o(){m.dropZone.mainTextZone.text("Drop the file to verify"),m.dropZone.subTextZone.text(""),m.info.message.buttonBox.button.tooltip.text(""),m.dropZone.addClass("expanded").show(),m.info.removeClass(["reduced","expanded"]).hide(),m.icon.removeClass(["validated","error"]).hide(),m.dropZone.inputContainer.progressBarContainer.hide(),f.reset.hide()}function n(e){var t=void 0,o=void 0,n=void 0,r=void 0,i=void 0;return t=e.getDate(),o=e.getMonth(),n=e.getFullYear(),r=e.getHours(),i=e.getMinutes(),[t,o+1,n].join("/")+" "+[r,i].join(":")}function r(){var e=this.files[0];e&&(this.value=null,"done"==p.state&&s(),"needReceipt"==p.state?(s("pending"),d(e).then(function(e){return woleet.verify.DAB(p.hash,e,function(e){v.style({width:100*e.progress+"%"})})}).then(function(e){s("woleet-ok",n(e.confirmedOn)),p.state="done"}).catch(function(t){"error_while_getting_transaction"==t.message&&0==p.retry?(p.retry=!0,woleet.transaction.setDefaultProvider("blockcypher.com"),r.call({files:[e]})):(console.trace(t),s("error",t))})):(p.hash=e,s("pending"),woleet.verify.WoleetDAB(e,function(e){v.style({width:100*e.progress+"%"})}).then(function(e){if(!e.length)throw new Error("need-receipt");p.state="done",s("woleet-ok",n(e[0].confirmedOn))}).catch(function(e){e.hasOwnProperty("code")||"need-receipt"==e.message?(p.state="needReceipt",s("need-receipt","Drop its receipt")):s("error",e)})))}function i(e){var t=m.info.message.buttonBox.button.tooltip,o=m.info.message.textZone;switch(e){case"need-receipt":o.text("File unknown to Woleet"),t.text("The receipt cannot be retreived from Woleet: you must provide it to verify this file");break;case"target_hash_mismatch":o.text("The provided receipt is not meant for this file"),t.text("The receipt's target_hash attribute doesn't match the file hash");break;case"unable_to_parse_json":o.text("The provided receipt cannot be parsed"),t.text("The file you provided doesn't look like a receipt");break;case"merkle_root_mismatch":o.text("The provided receipt seems corrupted"),t.text("The receipt's merkle_root attribute does not match the proof result");break;case"non_sha256_target_proof_element":o.text("The provided receipt seems corrupted"),t.text("An attribute in the proof (parent or left or right) in not a SHA256 hash");break;case"invalid_parent_in_proof_element":o.text("The provided receipt seems corrupted"),t.text("A parent in the proof does not match SHA256(left+right).");break;case"invalid_receipt_format":o.text("The provided receipt seems corrupted"),t.text("The proof miss an attribute (parent or left or right).");break;case"invalid_target_proof":o.text("The provided receipt seems corrupted"),t.text("The receipt does not conform to the Chainpoint 1.x format");break;case"tx_not_found":o.text("Transaction not found"),t.text("The transaction targeted by the receipt cannot be found");break;case"error_while_getting_transaction":o.text("Cannot get transaction"),t.text("There was an error while getting the transaction (try again)");break;default:o.text(e),t.text("unexpected case")}}function a(e){console.error(e.message);var t=e.message||"Something bad happened";m.info.removeClass("reduced").addClass("expanded").show(),m.dropZone.inputContainer.progressBarContainer.hide(),m.icon.addClass("error").show(),m.dropZone.removeClass("expanded").hide(),f.reset.show(),i(t)}function s(e,t){switch(e){case"woleet-ok":case"receipt-ok":m.icon.show();var n=t.split(" ");m.dropZone.mainTextZone.text(n[0]),m.dropZone.subTextZone.text(n[1]),m.dropZone.removeClass("expanded"),m.icon.addClass("validated"),m.info.removeClass("reduced").hide(),m.dropZone.inputContainer.progressBarContainer.hide(),m.dropZone.attr("disabled",!0),i("");break;case"need-receipt":m.dropZone.mainTextZone.text(t),m.dropZone.removeClass("expanded"),m.info.message.textZone.text("need receipt"),m.info.addClass("reduced").show(),m.dropZone.inputContainer.progressBarContainer.hide(),f.reset.show(),i("need-receipt");break;case"receipt-ko":case"error":a(t);break;case"pending":m.info.hide(),m.icon.hide(),m.dropZone.mainTextZone.text("Hashing..."),m.dropZone.inputContainer.progressBarContainer.show(),i("");break;case"init":default:o()}}function d(e){return new Promise(function(t,o){var n=new FileReader;n.onloadend=function(e){try{t(JSON.parse(e.target.result))}catch(e){o(new Error("unable_to_parse_json"))}},n.readAsText(e)})}function c(){s("init"),p.retry=!1,p.hash=null,p.state="initial"}if(!t&&e&&"object"==("undefined"==typeof e?"undefined":_typeof(e)))t=e,e=null;else if(e&&"string"!=typeof e)throw new Error("Invalid parameter type");var p={state:"initial",hash:null,retry:!1},l=function e(t){var o=this,n=t;this.target=function(){return n},this.removeClass=function(e){return Array.isArray(e)?e.forEach(function(e){return n.classList.remove(e)}):n.classList.remove(e),o},this.addClass=function(e){return Array.isArray(e)?e.forEach(function(e){return n.classList.add(e)}):n.classList.add(e),o},this.text=function(e,t){return t?n.innerText+=e:n.innerText=e,o},this.show=function(){return o.removeClass("hidden")},this.hide=function(){return o.addClass("hidden")},this.style=function(e){if(Array.isArray(e))return e.map(function(e){return n.style[e]});if("string"==typeof e)return n.style[e];for(var t in e)n.style[t]=e[t]},this.attr=function(e,t){return t?n.setAttribute(e,t):n.removeAttribute(e),o},this.on=function(e,t,r){return n.addEventListener(e,t,r),o},this.toDom=function(){var t=["target","text","show","hide","toDom","addClass","removeClass","attr","on","style"],n=o.target();for(var r in o)if(o.hasOwnProperty(r)&&t.indexOf(r)==-1&&!(!r instanceof e))try{n.appendChild(o[r].toDom())}catch(e){console.log(r,e)}return n}},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments[1],o=new l(document.createElement(e));return t&&o.addClass(t),o},h=u("div","widget"),f=h.head=u("div","head");f.logo=u("div","woleet-logo"),f.reset=u("div",["reset-button","clickable"]).on("click",c),h.body=u();var m=h.body.content=u();m.icon=u("div","infoStatus"),m.info=u("div","infoBox"),m.info.message=u("div","messageBox"),m.info.message.buttonBox=u("div","buttonBox"),m.info.message.buttonBox.button=u("div",["info","tooltip","clickable"]),m.info.message.buttonBox.button.tooltip=u("span",["tooltiptext"]),m.info.message.textZone=u("div","text"),m.dropZone=u("div","dropZoneContainer"),m.dropZone.mainTextZone=u("div","text"),m.dropZone.subTextZone=u("div",["text","little"]),m.dropZone.inputContainer=u("div","subContainer"),m.dropZone.inputContainer.progressBarContainer=u("div").hide();var v=m.dropZone.inputContainer.progressBarContainer.progressBar=u("div","progressBar");return m.dropZone.inputContainer.input=u("input",["dropZone","clickable"]).attr("type","file").on("change",r),o(),e&&r.call({files:[e]}),h.toDom()}document.addEventListener("DOMContentLoaded",function(){for(var e=document.getElementsByClassName("woleet-widget"),o=0;o<e.length;o++){var n=e[o],r=n.getAttribute("data-hash");n.appendChild(new t(r))}}),e.Widget=t}(window);
//# sourceMappingURL=woleet-widget.min.js.map
