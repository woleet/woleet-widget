"use strict";!function(e){function t(e){function t(){f.dropZone.mainTextZone.text("Drop the file to verify"),f.dropZone.subTextZone.text(""),f.info.message.buttonBox.button.tooltip.text(""),f.dropZone.addClass("expanded").show(),f.info.removeClass(["reduced","expanded"]).hide(),f.icon.removeClass(["validated","error"]).hide(),f.dropZone.inputContainer.progressBarContainer.hide(),l.reset.hide()}function n(e){var t=void 0,n=void 0,o=void 0,r=void 0,i=void 0;return t=e.getDate(),n=e.getMonth(),o=e.getFullYear(),r=e.getHours(),i=e.getMinutes(),[t,n+1,o].join("/")+" "+[r,i].join(":")}function o(){var e=this.files[0];e&&(this.value=null,"done"==c.state&&a(),"needReceipt"==c.state?(a("pending"),s(e).then(function(e){return woleet.verify.DAB(c.hash,e,function(e){v.style({width:100*e.progress+"%"})})}).then(function(e){a("woleet-ok",n(e.confirmedOn)),c.state="done"}).catch(function(e){a("error",e)})):(c.hash=e,a("pending"),woleet.verify.WoleetDAB(e,function(e){v.style({width:100*e.progress+"%"})}).then(function(e){if(!e.length)throw new Error("need-receipt");c.state="done",a("woleet-ok",n(e[0].confirmedOn))}).catch(function(e){e.hasOwnProperty("code")||"need-receipt"==e.message?(c.state="needReceipt",a("need-receipt","Drop its receipt")):a("error",e)})))}function r(e){var t=f.info.message.buttonBox.button.tooltip,n=f.info.message.textZone;switch(e){case"need-receipt":n.text("File unknown to Woleet"),t.text("The receipt cannot be retreived from Woleet: you must provide it to verify this file");break;case"target_hash_mismatch":n.text("The provided receipt is not meant for this file"),t.text("The receipt's target_hash attribute doesn't match the file hash");break;case"unable_to_parse_json":n.text("The provided receipt cannot be parsed"),t.text("The file you provided doesn't look like a receipt");break;case"merkle_root_mismatch":n.text("The provided receipt seems corrupted"),t.text("The receipt's merkle_root attribute does not match the proof result");break;case"non_sha256_target_proof_element":n.text("The provided receipt seems corrupted"),t.text("An attribute in the proof (parent or left or right) in not a SHA256 hash");break;case"invalid_parent_in_proof_element":n.text("The provided receipt seems corrupted"),t.text("A parent in the proof does not match SHA256(left+right).");break;case"invalid_receipt_format":n.text("The provided receipt seems corrupted"),t.text("The proof miss an attribute (parent or left or right).");break;case"invalid_target_proof":n.text("The provided receipt seems corrupted"),t.text("The receipt does not conform to the Chainpoint 1.x format");break;case"tx_not_found":n.text("Transaction not found"),t.text("The transaction targeted by the receipt cannot be found");break;case"error_while_getting_transaction":n.text("Cannot get transaction"),t.text("There was an error while getting the transaction (try again)");break;default:n.text(e),t.text("unexpected case")}}function i(e){console.error(e.message);var t=e.message||"Something bad happened";f.info.removeClass("reduced").addClass("expanded").show(),f.dropZone.inputContainer.progressBarContainer.hide(),f.icon.addClass("error").show(),f.dropZone.removeClass("expanded").hide(),l.reset.show(),r(t)}function a(e,n){switch(e){case"woleet-ok":case"receipt-ok":f.icon.show();var o=n.split(" ");f.dropZone.mainTextZone.text(o[0]),f.dropZone.subTextZone.text(o[1]),f.dropZone.removeClass("expanded"),f.icon.addClass("validated"),f.info.removeClass("reduced").hide(),f.dropZone.inputContainer.progressBarContainer.hide(),f.dropZone.attr("disabled",!0),r("");break;case"need-receipt":f.dropZone.mainTextZone.text(n),f.dropZone.removeClass("expanded"),f.info.message.textZone.text("need receipt"),f.info.addClass("reduced").show(),f.dropZone.inputContainer.progressBarContainer.hide(),l.reset.show(),r("need-receipt");break;case"receipt-ko":case"error":i(n);break;case"pending":f.info.hide(),f.icon.hide(),f.dropZone.mainTextZone.text("Hashing..."),f.dropZone.inputContainer.progressBarContainer.show(),r("");break;case"init":default:t()}}function s(e){return new Promise(function(t,n){var o=new FileReader;o.onloadend=function(e){try{t(JSON.parse(e.target.result))}catch(e){n(new Error("unable_to_parse_json"))}},o.readAsText(e)})}function d(){a("init"),c.hash=null,c.state="initial"}if(e&&"string"!=typeof e)throw new Error("Invalid parameter type");var c={state:"initial",hash:null},p=function e(t){var n=this,o=t;this.target=function(){return o},this.removeClass=function(e){return Array.isArray(e)?e.forEach(function(e){return o.classList.remove(e)}):o.classList.remove(e),n},this.addClass=function(e){return Array.isArray(e)?e.forEach(function(e){return o.classList.add(e)}):o.classList.add(e),n},this.text=function(e,t){return t?o.innerText+=e:o.innerText=e,n},this.show=function(){return n.removeClass("hidden")},this.hide=function(){return n.addClass("hidden")},this.style=function(e){if(Array.isArray(e))return e.map(function(e){return o.style[e]});if("string"==typeof e)return o.style[e];for(var t in e)o.style[t]=e[t]},this.attr=function(e,t){return t?o.setAttribute(e,t):o.removeAttribute(e),n},this.on=function(e,t,r){return o.addEventListener(e,t,r),n},this.toDom=function(){var t=["target","text","show","hide","toDom","addClass","removeClass","attr","on","style"],o=n.target();for(var r in n)if(n.hasOwnProperty(r)&&t.indexOf(r)==-1&&!(!r instanceof e))try{o.appendChild(n[r].toDom())}catch(e){console.log(r,e)}return o}},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments[1],n=new p(document.createElement(e));return t&&n.addClass(t),n},u=h("div","widget"),l=u.head=h("div","head");l.logo=h("div","woleet-logo"),l.reset=h("div",["reset-button","clickable"]).on("click",d),u.body=h();var f=u.body.content=h();f.icon=h("div","infoStatus"),f.info=h("div","infoBox"),f.info.message=h("div","messageBox"),f.info.message.buttonBox=h("div","buttonBox"),f.info.message.buttonBox.button=h("div",["info","tooltip","clickable"]),f.info.message.buttonBox.button.tooltip=h("span",["tooltiptext"]),f.info.message.textZone=h("div","text"),f.dropZone=h("div","dropZoneContainer"),f.dropZone.mainTextZone=h("div","text"),f.dropZone.subTextZone=h("div",["text","little"]),f.dropZone.inputContainer=h("div","subContainer"),f.dropZone.inputContainer.progressBarContainer=h("div").hide();var v=f.dropZone.inputContainer.progressBarContainer.progressBar=h("div","progressBar");return f.dropZone.inputContainer.input=h("input",["dropZone","clickable"]).attr("type","file").on("change",o),t(),e&&o.call({files:[e]}),u.toDom()}document.addEventListener("DOMContentLoaded",function(){for(var e=document.getElementsByClassName("woleet-widget"),n=0;n<e.length;n++){var o=e[n],r=o.getAttribute("data-hash");o.appendChild(new t(r))}}),e.Widget=t}(window);
//# sourceMappingURL=woleet-widget.min.js.map
