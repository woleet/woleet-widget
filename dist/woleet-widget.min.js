"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(e,t){function o(){f.dropZone.mainTextZone.text("Drop the file to verify"),f.dropZone.subTextZone.text(""),f.info.message.buttonBox.button.tooltip.text(""),f.dropZone.addClass("expanded").show(),f.info.removeClass(["reduced","expanded"]).hide(),f.icon.removeClass(["validated","error"]).hide(),f.dropZone.inputContainer.progressBarContainer.hide(),l.reset.hide()}function n(e){var t=void 0,o=void 0,n=void 0,r=void 0,i=void 0;return t=e.getDate(),o=e.getMonth(),n=e.getFullYear(),r=e.getHours(),i=e.getMinutes(),[t,o+1,n].join("/")+" "+[r,i].join(":")}function r(){var e=this.files[0];e&&(this.value=null,"done"==v&&a(),"needReceipt"==v?(a("pending"),s(e).then(function(e){woleet.verify.DAB(m,e,function(e){h.style({width:100*e.progress+"%"})}).then(function(e){a("woleet-ok",n(e.confirmedOn)),v="done"},function(e){a("error",e)})},function(e){a("error",e)})):(m=e,a("pending"),woleet.verify.WoleetDAB(e,function(e){h.style({width:100*e.progress+"%"})}).then(function(e){v="done",e.length?a("woleet-ok",n(e[0].confirmedOn)):a("need-receipt","Drop its receipt")},function(e){console.error(e),a("error",e)})))}function i(e){var t=f.info.message.buttonBox.button.tooltip,o=f.info.message.textZone;switch(e){case"need-receipt":o.text("File unknown to Woleet"),t.text("The receipt cannot be retreived from Woleet: you must provide it to verify this file");break;case"target_hash_mismatch":o.text("The provided receipt is not meant for this file"),t.text("The receipt's target_hash attribute doesn't match the file hash");break;case"unable_to_parse_json":o.text("The provided receipt cannot be parsed"),t.text("The file you provided doesn't look like a receipt");break;case"merkle_root_mismatch":o.text("The provided receipt seems corrupted"),t.text("The receipt's merkle_root attribute does not match the proof result");break;case"non_sha256_target_proof_element":o.text("The provided receipt seems corrupted"),t.text("An attribute in the proof (parent or left or right) in not a SHA256 hash");break;case"invalid_parent_in_proof_element":o.text("The provided receipt seems corrupted"),t.text("A parent in the proof does not match SHA256(left+right).");break;case"invalid_receipt_format":o.text("The provided receipt seems corrupted"),t.text("The proof miss an attribute (parent or left or right).");break;case"invalid_target_proof":o.text("The provided receipt seems corrupted"),t.text("The receipt does not conform to the Chainpoint 1.x format");break;case"tx_not_found":o.text("Transaction not found"),t.text("The transaction targeted by the receipt cannot be found");break;case"error_while_getting_transaction":o.text("Cannot get transaction"),t.text("There was an error while getting the transaction (try again)");break;default:o.text(e),t.text("Nothing to say")}}function a(e,t){switch(e){case"woleet-ok":case"receipt-ok":f.icon.show();var n=t.split(" ");f.dropZone.mainTextZone.text(n[0]),f.dropZone.subTextZone.text(n[1]),f.dropZone.removeClass("expanded"),f.icon.addClass("validated"),f.info.removeClass("reduced").hide(),f.dropZone.inputContainer.progressBarContainer.hide(),f.dropZone.attr("disabled",!0),i("");break;case"need-receipt":f.dropZone.mainTextZone.text(t),f.dropZone.removeClass("expanded"),f.info.message.textZone.text("need receipt"),f.info.addClass("reduced").show(),f.dropZone.inputContainer.progressBarContainer.hide(),l.reset.show(),i("need-receipt"),v="needReceipt";break;case"receipt-ko":case"error":console.error(t),f.info.removeClass("reduced").addClass("expanded").show(),f.dropZone.inputContainer.progressBarContainer.hide(),f.icon.addClass("error").show(),f.dropZone.removeClass("expanded").hide(),l.reset.show(),i(t.message);break;case"pending":f.info.hide(),f.icon.hide(),f.dropZone.mainTextZone.text("Hashing..."),f.dropZone.inputContainer.progressBarContainer.show(),i("");break;case"init":default:o()}}function s(e){return new Promise(function(t,o){var n=new FileReader;n.onloadend=function(e){try{t(JSON.parse(e.target.result))}catch(e){o(new Error("unable_to_parse_json"))}},n.readAsText(e)})}function d(){a("init"),m=null,v="initial"}if(e&&"object"==("undefined"==typeof e?"undefined":_typeof(e)))t=e,e=null;else if(e&&"string"!=typeof e)throw new Error("Invalid parameter type");var c=function e(t){var o=this,n=t;this.target=function(){return n},this.removeClass=function(e){return Array.isArray(e)?e.forEach(function(e){return n.classList.remove(e)}):n.classList.remove(e),o},this.addClass=function(e){return Array.isArray(e)?e.forEach(function(e){return n.classList.add(e)}):n.classList.add(e),o},this.text=function(e,t){return t?n.innerText+=e:n.innerText=e,o},this.show=function(){return o.removeClass("hidden")},this.hide=function(){return o.addClass("hidden")},this.style=function(e){if(Array.isArray(e))return e.map(function(e){return n.style[e]});if("string"==typeof e)return n.style[e];for(var t in e)n.style[t]=e[t]},this.attr=function(e,t){return t?n.setAttribute(e,t):n.removeAttribute(e),o},this.on=function(e,t,r){return n.addEventListener(e,t,r),o},this.toDom=function(){var t=["target","text","show","hide","toDom","addClass","removeClass","attr","on","style"],n=o.target();for(var r in o)if(o.hasOwnProperty(r)&&t.indexOf(r)==-1&&!(!r instanceof e))try{n.appendChild(o[r].toDom())}catch(e){console.log(r,e)}return n}},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments[1],o=new c(document.createElement(e));return t&&o.addClass(t),o},u=p("div","widget"),l=u.head=p("div","head");l.logo=p("div","woleet-logo"),l.reset=p("div",["reset-button","clickable"]).on("click",d),u.body=p();var f=u.body.content=p();f.icon=p("div","infoStatus"),f.info=p("div","infoBox"),f.info.message=p("div","messageBox"),f.info.message.buttonBox=p("div","buttonBox"),f.info.message.buttonBox.button=p("div",["info","tooltip","clickable"]),f.info.message.buttonBox.button.tooltip=p("span",["tooltiptext"]),f.info.message.textZone=p("div","text"),f.dropZone=p("div","dropZoneContainer"),f.dropZone.mainTextZone=p("div","text"),f.dropZone.subTextZone=p("div",["text","little"]),f.dropZone.inputContainer=p("div","subContainer"),f.dropZone.inputContainer.progressBarContainer=p("div").hide();var h=f.dropZone.inputContainer.progressBarContainer.progressBar=p("div","progressBar");f.dropZone.inputContainer.input=p("input",["dropZone","clickable"]).attr("type","file").on("change",r),o(),e&&r({target:{files:[e]}});var v="initial",m=void 0;return u.toDom()}document.addEventListener("DOMContentLoaded",function(){for(var e=document.getElementsByClassName("woleet-widget"),o=0;o<e.length;o++){var n=e[o],r=n.getAttribute("data-hash");n.appendChild(t(r))}}),e.Widget=t}(window);
//# sourceMappingURL=woleet-widget.min.js.map
